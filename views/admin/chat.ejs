<%- include('./partials/admin_nav') %>

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
  .chat-box {
    height: 400px;
    overflow-y: auto;
    background-color: #f9f9f9;
    padding: 1rem;
    border-radius: 10px;
    border: 1px solid #ddd;
  }
  .chat-bubble {
    max-width: 75%;
    padding: 10px 15px;
    border-radius: 1rem;
    position: relative;
    font-size: 1rem;
    line-height: 1.4;
  }
  .chat-right {
    background-color: #007bff;
    color: white;
    margin-left: auto;
    text-align: right;
  }
  .chat-left {
    background-color: #e9ecef;
    color: #333;
    margin-right: auto;
    text-align: left;
  }
  .chat-meta {
    font-size: 0.8rem;
    color: #888;
    margin-top: 2px;
  }
</style>

<div class="container mt-5">
  <h3 class="fw-bold text-center mb-4">
    <i class="bi bi-person-lines-fill me-2"></i>Chat with <%= user.name %>
  </h3>

  <div class="chat-box mb-3">
    <% if (messages.length === 0) { %>
      <p class="text-muted text-center">No messages yet.</p>
    <% } %>
    <% messages.forEach(msg => { 
      const isAdmin = msg.sender_id !== user.id;
    %>
      <div class="d-flex flex-column <%= isAdmin ? 'align-items-end' : 'align-items-start' %> mb-2">
        <div class="chat-bubble <%= isAdmin ? 'chat-right' : 'chat-left' %>">
          <%= msg.message %>
        </div>
        <div class="chat-meta">
          <%= msg.sender_name %> â€¢ <%= new Date(msg.timestamp).toLocaleString() %>
        </div>
      </div>
    <% }) %>
  </div>

  <form method="POST" class="d-flex">
    <input type="text" name="message" class="form-control me-2" placeholder="Type your message..." required>
    <button type="submit" class="btn btn-success rounded-pill">
      <i class="bi bi-send-fill"></i> Send
    </button>
  </form>
</div>
